{% extends 'base.html' %}

{% block title %}
  <title>user orders</title>
{% endblock %}

{% block content %}
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var menuItems = ['latest-status', 'unpaid', 'cancel', 'history']
    
      menuItems.forEach(function (itemId) {
        var item = document.getElementById(itemId)
        var link = item.querySelector('a')
    
        if (window.location.href.includes(link.getAttribute('href'))) {
          item.style.borderBottom = '2px solid #02a9f7'
          link.style.color = '#02a9f7'
        }
    
        item.addEventListener('mouseenter', function () {
          if (!window.location.href.includes(link.getAttribute('href'))) {
            item.style.borderBottom = '2px solid #02a9f7'
          }
        })
    
        item.addEventListener('mouseleave', function () {
          if (!window.location.href.includes(link.getAttribute('href'))) {
            item.style.borderBottom = ''
            link.style.color = ''
          }
        })
    
        link.addEventListener('click', function () {
          menuItems.forEach(function (itemId) {
            var otherItem = document.getElementById(itemId)
            var otherLink = otherItem.querySelector('a')
            otherItem.style.borderBottom = ''
            otherLink.style.color = ''
          })
    
          item.style.borderBottom = '2px solid #02a9f7'
          link.style.color = '#02a9f7'
        })
      })
    })
  </script>

  <nav class="user-order-status-bar">
    <ul class="user-order-status-links">
      <li id="latest-status">
        <a href="{% url 'latest_status_user_orders' %}">Latest status</a>
      </li>
      <li id="unpaid">
        <a href="{% url 'unpaid_user_orders' %}">Unpaid</a>
      </li>
      <li id="cancel">
        <a href="{% url 'cancel_order_user_orders' %}">Cancel order</a>
      </li>
      <li id="history">
        <a href="{% url 'history_user_orders' %}">History</a>
      </li>
    </ul>
  </nav>

  <div class="order-container">
    <div class="order-table">
      {% if user_orders %}
        <div class="order-header">
          <div>Order ID</div>
          <div>Contributor</div>
          <div>Item</div>
          <div>Start Time</div>
          <div>End Time</div>
          <div>Request Time</div>
          <div>Status</div>
          {% if unpaid_orders_exist %}
            <div class="cancel">Cancel</div>
          {% endif %}
        </div>

        {% for order in user_orders %}
          <div class="order-row">
            <div>{{ order.order_id }}</div>
            <div>{{ order.item.contributor }}</div>
            <div>{{ order.item.item_name }}</div>
            <div>{{ order.start_time }}</div>
            <div>{{ order.end_time }}</div>
            <div>{{ order.request_time }}</div>
            <div>{{ order.status }}</div>

            {% if order.status == 'unpaid' or order.status == 'wait_to_pay' %}
              <div class="cancel">
                <form method="post" action="{% url 'cancel_order' order.order_id %}">
                  {% csrf_token %}
                  <button type="submit" name="decision" value="Cancel Order" class="cancel-btn">cancel</button>
                </form>
              </div>
            {% endif %}
          </div>
        {% endfor %}
      {% else %}
        <p>No orders found !!!!!</p>
      {% endif %}
    </div>
  </div>
{% endblock %}
